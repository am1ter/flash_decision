{% extends "layout.html" %}

<!--Head-->

{% block title %}
    Terminal
{% endblock %}

{% block scripts %}
    <!-- Charts -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>

    <!-- Pivot table -->
    <link href="{{ url_for('static', filename='css/pivot.css') }}" rel="stylesheet" type="text/css">
    <script src="{{ url_for('static', filename='js/pivot.min.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='js/jquery-ui.min.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='js/plotly_renderers.js') }}" type="text/javascript"></script>
{% endblock %}

{% block head %}
    {{ super() }}
{% endblock %}

<!--Body-->

{% block header %}
    {{ super() }}
{% endblock %}

{% block content %}
<section class="content_results">

    <div id="layout_title">
        <h1 class="text_default title">Results</h1>
    </div>

    <div id="layout_separator_01">
        <div class="separator"></div>
    </div>

    {% if summary is defined %}
    <div id="layout_subtitle">
        <p class="text_default subtitle">Iterations: {{ summary['iterations'] | safe }}</p>
        <p class="text_default subtitle">Time spent: {{ summary['time'] | safe }} sec</p>
        <p class="text_default subtitle">Result: {{ summary['result'] | safe }}%</p>
    </div>
    {% endif %}

    <div id="layout_separator_02">
        <div class="separator"></div>
    </div>

    <!-- Import from python -->
    <div id='data' data-decisions='{{ data_json | safe }}'></div>

    <!-- Show results pivot table -->
    <div id="output"></div>

    <script type="text/javascript">

        /* Read data from python */
        var dataset = document.querySelector('#data');
        var data_decisions = dataset.dataset.decisions;
        var data_json = JSON.parse(data_decisions);

        var utils = $.pivotUtilities;
        var renderers = $.extend(utils.renderers,
                                 utils.plotly_renderers
                                 );

        $("#output").pivotUI(
            data_json, {
                renderers: renderers,
                rendererName: "Line Chart",
                // rendererName: "Stacked Bar Chart",
                // rows: ["result"],
                cols: ["session_id"],
                vals: ["decision_result_corrected"],
                aggregatorName: "Sum",
                rendererOptions: { plotly: {width: 724, height: 500} }
        });
    </script>

</section>

{% endblock %}