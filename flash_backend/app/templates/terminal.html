{% extends "layout.html" %}

<!--Head-->

{% block title %}
    Terminal
{% endblock %}

{% block scripts %}
    <!-- Timer -->
    <script src="{{ url_for('static', filename='js/terminal_timer.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='js/terminal_hotkeys.js') }}" type="text/javascript"></script>

    <!-- Charts -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
{% endblock %}

{% block head %}
    {{ super() }}
{% endblock %}

<!--Body-->

{% block header %}
    {{ super() }}
{% endblock %}

{% block content %}
<section class="content_terminal">

    <div id="layout_title">
        <h1 class="text_default title">Terminal</h1>
    </div>

    <div id="layout_separator_01">
        <div class="separator"></div>
    </div>

    <div id="layout_subtitle">
        <p class="text_default subtitle">Current ticker: {{ session.case_ticker | safe }}</p>
        <p class="text_default subtitle">
            Time limit: <label id="time_limit">{{ session.case_timelimit | safe }}</label> sec
        </p>
        <p class="text_default subtitle">
            Time spent: <label id="minutes">00</label>:<label id="seconds">00</label>
        </p>
    </div>

    <div id="layout_separator_02">
        <div class="separator"></div>
    </div>

    <div class="chart" id="chart">
        <script>
            var graphs = {{plot | safe}};
            var data = [graphs[0].data[0]];
            var layout = {
                        title: {visible: false},
                        dragmode: 'zoom',
                        showlegend: false,
                        height: 350,
                        margin: {
                            r: 10,
                            t: 25,
                            b: 40,
                            l: 60
                        },
                        xaxis: {
                            autorange: true,
                            rangeslider: {visible: false},
                            title: 'Date',
                            showticklabels: false
                          }
                        };
            Plotly.plot('chart', data, layout);
        </script>
    </div>

    <div>
        <div class="layout_forms_right_input" id="layout_button_start">
            <div class="btn-group" role="group">
                <form action="{{ url_for('web_terminal_post') }}" method="POST">
                    <input type="hidden" name="session_id" value="{{ session.session_id }}">
                    <input type="hidden" name="total_iterations" value="{{ session.case_iterations }}">
                    <input type="hidden" name="iteration" value="{{ iteration }}">
                    <input type="hidden" name="datetime" value="{{ session.case_datetime }}">
                    <input type="hidden" name="time_spent" id="time_spent" value="0"> <!-- Updated by js timer -->
                    <button type="submit" class="btn btn-default" name="form_button" id="btn_buy" value="buy">Buy</button>
                    <button type="submit" class="btn btn-default" name="form_button" id="btn_sell" value="sell">Sell</button>
                    <button type="submit" class="btn btn-default" name="form_button" id="btn_skip" value="skip">Skip</button>
                </form>
            </div>
        </div>
    </div>

</section>
{% endblock %}